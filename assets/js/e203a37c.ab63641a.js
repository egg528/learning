"use strict";(self.webpackChunktest=self.webpackChunktest||[]).push([[1715],{6509:(e,r,t)=>{t.r(r),t.d(r,{assets:()=>s,contentTitle:()=>l,default:()=>p,frontMatter:()=>i,metadata:()=>o,toc:()=>c});var n=t(4848),a=t(8453);const i={title:"2. Spring Batch \uc790\uc138\ud788 \uc0b4\ud3b4\ubcf4\uae30",sidebar_position:2,tag:["lecture","spring batch"]},l=void 0,o={id:"lecture/spring-batch/2",title:"2. Spring Batch \uc790\uc138\ud788 \uc0b4\ud3b4\ubcf4\uae30",description:"JobParameterValidator",source:"@site/docs/resource/lecture/spring-batch/2.md",sourceDirName:"lecture/spring-batch",slug:"/lecture/spring-batch/2",permalink:"/resource/lecture/spring-batch/2",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{title:"2. Spring Batch \uc790\uc138\ud788 \uc0b4\ud3b4\ubcf4\uae30",sidebar_position:2,tag:["lecture","spring batch"]},sidebar:"tutorialSidebar",previous:{title:"1. Spring Batch \uac1c\ub150",permalink:"/resource/lecture/spring-batch/1"},next:{title:"3. Spring Batch \ubcd1\ub82c \ucc98\ub9ac",permalink:"/resource/lecture/spring-batch/3"}},s={},c=[{value:"JobParameterValidator",id:"jobparametervalidator",level:2},{value:"JobExecutionListner",id:"jobexecutionlistner",level:2},{value:"FlatFileItemReader",id:"flatfileitemreader",level:2},{value:"\uc608\uc2dc (\uacf5\uc2dd \ubb38\uc11c \uc608\uc2dc\uc5d0 \ub300\ud55c FlatFileItemReader)",id:"\uc608\uc2dc-\uacf5\uc2dd-\ubb38\uc11c-\uc608\uc2dc\uc5d0-\ub300\ud55c-flatfileitemreader",level:3},{value:"Reference",id:"reference",level:3},{value:"StepListener",id:"steplistener",level:2},{value:"Reference",id:"reference-1",level:3},{value:"ItemProcessorAdapter",id:"itemprocessoradapter",level:2},{value:"1. Step\uc5d0\uc11c \uad6c\ud604",id:"1-step\uc5d0\uc11c-\uad6c\ud604",level:3},{value:"2. ItemProcessor\ub85c \ubd84\ub9ac",id:"2-itemprocessor\ub85c-\ubd84\ub9ac",level:3},{value:"3. ItemProcessorAdapter",id:"3-itemprocessoradapter",level:3},{value:"FlatFileItemWriter",id:"flatfileitemwriter",level:2}];function d(e){const r={a:"a",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.h2,{id:"jobparametervalidator",children:"JobParameterValidator"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:["CLI Arguments\ub97c \ud1b5\ud574 JobParameter\ub97c \ub118\uae38 \uc218 \uc788\ub2e4.","\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsx)(r.li,{children:"\uc608\uc2dc -\ubcc0\uc218\uba85=\uac12"}),"\n",(0,n.jsx)(r.li,{children:"\ub9e4\uac1c\ubcc0\uc218 \uc815\uc758\uc5d0\uc11c @Value(\"#{jobParameters['targetDate']}\")"}),"\n",(0,n.jsxs)(r.li,{children:["\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-java",children:'@StepScope\n@Bean\npublic Tasklet advancedTasklet(@Value("#{jobParameters[\'targetDate\']}") String targetDate) {\n    return (contribution, chunkContext) -> {\n        log.info("[AdvancedJobConfig] JobParameter - targetDate = " + targetDate);\n        log.info("[AdvancedJobConfig] executed advancedTasklet");\n        return RepeatStatus.FINISHED;\n    };\n}\n'})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(r.li,{children:["JobParametersValidator Interface\ub97c \uad6c\ud604\ud558\uc5ec JobParameter\ub97c \uac80\uc99d\ud560 \uc218 \uc788\ub2e4.","\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:["\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-java",children:'@AllArgsConstructor\npublic class LocalDateParameterValidator implements JobParametersValidator {\n\n    private String parameterName;\n\n    @Override\n    public void validate(JobParameters parameters) throws JobParametersInvalidException {\n        String localDate = parameters.getString(parameterName);\n\n        if (!StringUtils.hasText(localDate)) {\n            throw new JobParametersInvalidException(parameterName + "\uac00 \ube48 \ubb38\uc790\uc5f4\uc774\uac70\ub098 \uc874\uc7ac\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4.");\n        }\n\n        try {\n            LocalDate.parse(localDate);\n        } catch (DateTimeParseException e) {\n            throw new JobParametersInvalidException(parameterName + "\uac00 \ub0a0\uc9dc \ud615\uc2dd\uc758 \ubb38\uc790\uc5f4\uc774 \uc544\ub2d9\ub2c8\ub2e4.");\n        }\n    }\n}\n\n\n// Validator \uc0ac\uc6a9\ubd80\n@Bean\npublic Job advancedJob(JobExecutionListener jobExecutionListener,\n                       Step advancedStep) {\n    return jobBuilderFactory.get("advancedJob")\n            .incrementer(new RunIdIncrementer())\n            .validator(new LocalDateParameterValidator("targetDate")) // validator \ucd94\uac00\n            .listener(jobExecutionListener)\n            .start(advancedStep)\n            .build();\n}\n'})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(r.h2,{id:"jobexecutionlistner",children:"JobExecutionListner"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsx)(r.li,{children:"JobExecutionListner\uc744 \uad6c\ud604\ud558\uc5ec \uc2e4\ud589 \uc804, \uc2e4\ud589 \ud6c4 \uc0c1\ud0dc\ub97c \uc810\uac80\ud560 \uc218 \uc788\ub2e4."}),"\n",(0,n.jsx)(r.li,{children:"\uc2dc\uc791 \uc804, \uc2dc\uc791 \ud6c4 \uc774\uc0c1 \uc0c1\ud0dc\uc5d0 \ub300\ud574 \uc54c\ub9bc\uc744 \ubcf4\ub0bc \uc218 \uc788\uc74c."}),"\n"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-java",children:'    @JobScope\n    @Bean\n    public JobExecutionListener jobExecutionListener() {\n        return new JobExecutionListener() {\n            @Override\n            public void beforeJob(JobExecution jobExecution) {\n                log.info("[JobExecutionListener#beforeJob] jobExecution is " + jobExecution.getStatus());\n            }\n\n            @Override\n            public void afterJob(JobExecution jobExecution) {\n                if (jobExecution.getStatus() == BatchStatus.FAILED) {\n                    log.error("[JobExecutionListener#afterJob] JobExecution is FAILED!!! RECOVER ASAP");\n                }\n                \n                // \uc2e4\ud328\ud558\uac70\ub098 \uc6d0\ud558\ub294 \uacb0\uacfc\uac00 \ub098\uc624\uc9c0 \ubabb\ud588\uc744 \ub584 \uc54c\ub9bc\uc744 \ubcf4\ub0b4\ub294 \ub85c\uc9c1\uc744 \ucd94\uac00\ud560 \uc218 \uc788\uc74c\n            }\n        };\n    }\n    \n    @Bean\n    public Job advancedJob(JobExecutionListener jobExecutionListener,\n                           Step advancedStep) {\n        return jobBuilderFactory.get("advancedJob")\n                .incrementer(new RunIdIncrementer())\n                .validator(new LocalDateParameterValidator("targetDate"))\n                .listener(jobExecutionListener) // listener\n                .start(advancedStep)\n                .build();\n    }\n'})}),"\n",(0,n.jsx)(r.h2,{id:"flatfileitemreader",children:"FlatFileItemReader"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:["Chunk \uae30\ubc18\uc73c\ub85c \ud30c\uc77c\uc744 \uc77d\uc5b4\uc62c \uc218 \uc788\uc74c\n",(0,n.jsx)(r.img,{alt:"flatfileitemreader.png",src:t(3766).A+"",width:"1940",height:"1410"})]}),"\n",(0,n.jsxs)(r.li,{children:["\uc8fc\uc694 \ud2b9\uc131","\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsx)(r.li,{children:"lineMapper: String to Object"}),"\n",(0,n.jsx)(r.li,{children:"lineToSkip: \uc124\uc815\ud55c line\ub9cc\ud07c \ubb34\uc2dc"}),"\n",(0,n.jsx)(r.li,{children:"recordSeparatorPolicy: \ub370\uc774\ud130 \uad6c\ubd84 \uac12"}),"\n",(0,n.jsx)(r.li,{children:"resource: \uc77d\uc744 File \uc815\ubcf4"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(r.h3,{id:"\uc608\uc2dc-\uacf5\uc2dd-\ubb38\uc11c-\uc608\uc2dc\uc5d0-\ub300\ud55c-flatfileitemreader",children:"\uc608\uc2dc (\uacf5\uc2dd \ubb38\uc11c \uc608\uc2dc\uc5d0 \ub300\ud55c FlatFileItemReader)"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-java",children:'// @Bean \uc0dd\uc131\ubd80\n@StepScope\n@Bean\npublic FlatFileItemReader<PlayerDto> playerFileItemReader() {\n    return new FlatFileItemReaderBuilder<PlayerDto>()\n            .name("playerFileItemReader")\n            .lineTokenizer(new DelimitedLineTokenizer()) // recordSeparatorPolicy \uc124\uc815, DelimitedLineTokenizer\uc758 Default\ub294 \',\'\n            .linesToSkip(1) // \uccab \uc904 \uc0dd\ub7b5\n            .fieldSetMapper(new PlayerFieldSetMapper()) // PlayerFieldSetMapper.mapFieldSet \ubc18\ud658\uac12\uc73c\ub85c \ubcc0\ud658\n            .resource(new FileSystemResource("player-list.txt")) // resource \uc815\ubcf4\n            .build();\n}\n\n// Mapper\npublic class PlayerFieldSetMapper implements FieldSetMapper<PlayerDto> {\n    @Override\n    public PlayerDto mapFieldSet(FieldSet fieldSet) throws BindException {\n        PlayerDto dto = new PlayerDto();\n        dto.setID(fieldSet.readString(0));\n        dto.setLastName(fieldSet.readString(1));\n        dto.setFirstName(fieldSet.readString(2));\n        dto.setPosition(fieldSet.readString(3));\n        dto.setBirthYear(fieldSet.readInt(4));\n        dto.setDebutYear(fieldSet.readInt(5));\n        return dto;\n    }\n}   \n'})}),"\n",(0,n.jsx)(r.h3,{id:"reference",children:"Reference"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsx)(r.li,{children:(0,n.jsx)(r.a,{href:"https://docs.spring.io/spring-batch/docs/current/reference/html/index-single.html#flatFileItemReader",children:"Spring FlatFileItemReader \uacf5\uc2dd \uac00\uc774\ub4dc"})}),"\n"]}),"\n",(0,n.jsx)(r.h2,{id:"steplistener",children:"StepListener"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsx)(r.li,{children:"JobExecutionListner\ucc98\ub7fc Step \uc2e4\ud589 \uc774\uc804/\uc774\ud6c4 \uc0c1\ud0dc\ub3c4 \uc54c \uc218 \uc788\ub2e4."}),"\n"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-java",children:'    @StepScope\n    @Bean\n    public StepExecutionListener stepExecutionListener() {\n        return new StepExecutionListener() {\n            @Override\n            public void beforeStep(StepExecution stepExecution) {\n                log.info("[StepExecutionListener#beforeStep] stepExecution is " + stepExecution.getStatus());\n            }\n\n            @Override\n            public ExitStatus afterStep(StepExecution stepExecution) {\n                log.info("[StepExecutionListener#afterStep] stepExecution is " + stepExecution.getStatus());\n                return stepExecution.getExitStatus();\n            }\n        };\n    }\n    \n    // Listener \uc0ac\uc6a9\ubd80\n    @JobScope\n    @Bean\n    public Step advancedStep(StepExecutionListener stepExecutionListener,\n                             Tasklet advancedTasklet) {\n        return stepBuilderFactory.get("advancedStep")\n                .listener(stepExecutionListener)\n                .tasklet(advancedTasklet)\n                .build();\n    }\n'})}),"\n",(0,n.jsx)(r.h3,{id:"reference-1",children:"Reference"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsx)(r.li,{children:(0,n.jsx)(r.a,{href:"https://docs.spring.io/spring-batch/docs/current/reference/html/index-single.html#stepExecutionListener",children:"Spring StepExecutionListener \uacf5\uc2dd \uac00\uc774\ub4dc"})}),"\n"]}),"\n",(0,n.jsx)(r.h2,{id:"itemprocessoradapter",children:"ItemProcessorAdapter"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsx)(r.li,{children:"processor \ub85c\uc9c1\uc744 \uad6c\ud604\ud558\ub294 3\uac00\uc9c0 \ubc29\uc2dd"}),"\n"]}),"\n",(0,n.jsx)(r.h3,{id:"1-step\uc5d0\uc11c-\uad6c\ud604",children:"1. Step\uc5d0\uc11c \uad6c\ud604"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-java",children:'    @JobScope\n    @Bean\n    public Step flatFileStep(FlatFileItemReader<PlayerDto> playerFileItemReader,\n                             PlayerSalaryService playerSalaryService,\n                             FlatFileItemWriter<PlayerSalaryDto> playerFileItemWriter\n                             ) {\n        return stepBuilderFactory.get("flatFileStep")\n                .<PlayerDto, PlayerSalaryDto>chunk(5)\n                .reader(playerFileItemReader)\n                .processor(new ItemProcessor<PlayerDto, PlayerSalaryDto>() {\n                    @Override\n                    public PlayerSalaryDto process(PlayerDto item) throws Exception {\n                        return playerSalaryService.calcSalary(item);\n                    }\n                })\n                .writer(playerFileItemWriter)\n                .build();\n    }\n'})}),"\n",(0,n.jsx)(r.h3,{id:"2-itemprocessor\ub85c-\ubd84\ub9ac",children:"2. ItemProcessor\ub85c \ubd84\ub9ac"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-java",children:'    @JobScope\n    @Bean\n    public Step flatFileStep(FlatFileItemReader<PlayerDto> playerFileItemReader,\n                             ItemProcessor<PlayerDto, PlayerSalaryDto> itemProcessor,\n                             FlatFileItemWriter<PlayerSalaryDto> playerFileItemWriter\n                             ) {\n        return stepBuilderFactory.get("flatFileStep")\n                .<PlayerDto, PlayerSalaryDto>chunk(5)\n                .reader(playerFileItemReader)\n                .processor(itemProcessor)\n                .writer(playerFileItemWriter)\n                .build();\n    }\n\n    @StepScope\n    @Bean\n    public ItemProcessor<PlayerDto, PlayerSalaryDto> playerSalaryItemProcessor(PlayerSalaryService playerSalaryService){\n        return new ItemProcessor<PlayerDto, PlayerSalaryDto>() {\n            @Override\n            public PlayerSalaryDto process(PlayerDto item) throws Exception {\n                return playerSalaryService.calcSalary(item);\n            }\n        };\n    }\n'})}),"\n",(0,n.jsx)(r.h3,{id:"3-itemprocessoradapter",children:"3. ItemProcessorAdapter"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{children:'    @JobScope\n    @Bean\n    public Step flatFileStep(FlatFileItemReader<PlayerDto> playerFileItemReader,\n                             ItemProcessorAdapter<PlayerDto, PlayerSalaryDto> playerSalaryItemProcessorAdapter,\n                             FlatFileItemWriter<PlayerSalaryDto> playerFileItemWriter\n                             ) {\n        return stepBuilderFactory.get("flatFileStep")\n                .<PlayerDto, PlayerSalaryDto>chunk(5)\n                .reader(playerFileItemReader)\n                .processor(playerSalaryItemProcessorAdapter)\n                .writer(playerFileItemWriter)\n                .build();\n    }\n    \n    @StepScope\n    @Bean\n    public ItemProcessorAdapter<PlayerDto, PlayerSalaryDto> playerSalaryItemProcessorAdapter(PlayerSalaryService playerSalaryService) {\n        ItemProcessorAdapter<PlayerDto, PlayerSalaryDto> adapter = new ItemProcessorAdapter<>();\n        adapter.setTargetObject(playerSalaryService); // \uc0ac\uc6a9\ud558\ub294 \ud074\ub798\uc2a4 \uba85\n        adapter.setTargetMethod("calcSalary"); // \uc0ac\uc6a9\ud558\ub294 \uba54\uc11c\ub4dc \uba85\n        return adapter;\n    }\n'})}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsx)(r.li,{children:"\uc870\uae08 \ub354 \uac04\ub2e8\ud558\uac8c \uad6c\ud604\uc774 \uac00\ub2a5\ud574\uc9c4\ub2e4."}),"\n"]}),"\n",(0,n.jsx)(r.h2,{id:"flatfileitemwriter",children:"FlatFileItemWriter"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsx)(r.li,{children:"FlatFileItemWriter\ub97c \uc774\uc6a9\ud558\uba74 \uacb0\uacfc\ub97c \ud30c\uc77c\ub85c \ubc18\ud658\ud560 \uc218 \uc788\ub2e4"}),"\n"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-java",children:'    @StepScope\n    @Bean\n    public FlatFileItemWriter<PlayerSalaryDto> playerFileItemWriter() throws IOException {\n        BeanWrapperFieldExtractor<PlayerSalaryDto> fieldExtractor = new BeanWrapperFieldExtractor<>();\n        fieldExtractor.setNames(new String[]{"ID", "firstName", "lastName", "salary"}); // PlayerSalaryDto\uc5d0\uc11c \uc0ac\uc6a9\ud560 \uac12 \uc815\uc758\n        fieldExtractor.afterPropertiesSet();\n\n        DelimitedLineAggregator<PlayerSalaryDto> lineAggregator = new DelimitedLineAggregator<>();\n        lineAggregator.setDelimiter("\\t"); // \uad6c\ubd84\uc790 tab\n        lineAggregator.setFieldExtractor(fieldExtractor);\n\n        // \uae30\uc874\uc758 \ud30c\uc77c\uc744 \ub36e\uc5b4\uc4f4\ub2e4.\n        new File("player-salary-list.txt").createNewFile();\n        FileSystemResource resource = new FileSystemResource("player-salary-list.txt");\n\n        return new FlatFileItemWriterBuilder<PlayerSalaryDto>()\n                .name("playerFileItemWriter")\n                .resource(resource) // \ud30c\uc77c\uc744 \uc4f8 resource \uc9c0\uc815\n                .lineAggregator(lineAggregator) // \uac12\ub4e4\uc744 \uc5b4\ub5bb\uac8c \uc870\ud569\ud560 \uac83\uc778\uac00\n                .build();\n    }\n'})})]})}function p(e={}){const{wrapper:r}={...(0,a.R)(),...e.components};return r?(0,n.jsx)(r,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},3766:(e,r,t)=>{t.d(r,{A:()=>n});const n=t.p+"assets/images/flatfileitemreader-586c07ab3b1c33519ed82eb5d482dd71.png"},8453:(e,r,t)=>{t.d(r,{R:()=>l,x:()=>o});var n=t(6540);const a={},i=n.createContext(a);function l(e){const r=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function o(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:l(e.components),n.createElement(i.Provider,{value:r},e.children)}}}]);