"use strict";(self.webpackChunktest=self.webpackChunktest||[]).push([[8097],{1980:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>c,contentTitle:()=>a,default:()=>p,frontMatter:()=>o,metadata:()=>s,toc:()=>l});var r=t(4848),i=t(8453);const o={title:"7. \ube48 \ud6c4\ucc98\ub9ac\uae30",sidebar_position:7,tag:["lecture","spring advance"]},a=void 0,s={id:"lecture/spring-advance/7",title:"7. \ube48 \ud6c4\ucc98\ub9ac\uae30",description:"\ud604\uc7ac\uc758 \ubb38\uc81c\uc810...",source:"@site/docs/resource/lecture/spring-advance/7.md",sourceDirName:"lecture/spring-advance",slug:"/lecture/spring-advance/7",permalink:"/resource/lecture/spring-advance/7",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:7,frontMatter:{title:"7. \ube48 \ud6c4\ucc98\ub9ac\uae30",sidebar_position:7,tag:["lecture","spring advance"]},sidebar:"tutorialSidebar",previous:{title:"6. \uc2a4\ud504\ub9c1\uc774 \uc9c0\uc6d0\ud558\ub294 \ud504\ub85d\uc2dc",permalink:"/resource/lecture/spring-advance/6"},next:{title:"8. @AspectAOP",permalink:"/resource/lecture/spring-advance/8"}},c={},l=[{value:"\ud604\uc7ac\uc758 \ubb38\uc81c\uc810...",id:"\ud604\uc7ac\uc758-\ubb38\uc81c\uc810",level:2},{value:"\ube48 \ud6c4\ucc98\ub9ac\uae30",id:"\ube48-\ud6c4\ucc98\ub9ac\uae30",level:2},{value:"\uc608\uc81c 1",id:"\uc608\uc81c-1",level:3},{value:"\uc608\uc81c 2",id:"\uc608\uc81c-2",level:3},{value:"\uc2a4\ud504\ub9c1\uc774 \uc81c\uacf5\ud558\ub294 \ube48 \ud6c4\ucc98\ub9ac\uae30",id:"\uc2a4\ud504\ub9c1\uc774-\uc81c\uacf5\ud558\ub294-\ube48-\ud6c4\ucc98\ub9ac\uae30",level:2},{value:"(1) AutoProxyCreator",id:"1-autoproxycreator",level:3},{value:"AnnotationAwareAspectJAutoProxyCreator",id:"annotationawareaspectjautoproxycreator",level:4},{value:"\ub3d9\uc791 \uacfc\uc815",id:"\ub3d9\uc791-\uacfc\uc815",level:4},{value:"\uc608\uc81c 1",id:"\uc608\uc81c-1-1",level:4},{value:"[\ucc38\uace0] Pointcut\uc758 \uc0ac\uc6a9 \uc2dc\uc810",id:"\ucc38\uace0-pointcut\uc758-\uc0ac\uc6a9-\uc2dc\uc810",level:4},{value:"(2) AspectJExpressionPointcut",id:"2-aspectjexpressionpointcut",level:3},{value:"\ucc38\uace0: Pointcut \uc5ec\ub7ec\uac1c\ub97c \ub9cc\uc871\ud558\ub294 Bean\uc740?",id:"\ucc38\uace0-pointcut-\uc5ec\ub7ec\uac1c\ub97c-\ub9cc\uc871\ud558\ub294-bean\uc740",level:3}];function d(n){const e={code:"code",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.h2,{id:"\ud604\uc7ac\uc758-\ubb38\uc81c\uc810",children:"\ud604\uc7ac\uc758 \ubb38\uc81c\uc810..."}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\uc124\uc815 \ud30c\uc77c(~Config)\uc774 \ub108\ubb34 \ub9ce\ub2e4.."}),"\n",(0,r.jsxs)(e.li,{children:["\ucef4\ud3ec\ub10c\ud2b8 \uc2a4\uce94\uc744 \uc774\uc6a9\ud560 \uc218 \uc5c6\ub2e4.","\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\ucef4\ud3ec\ub10c\ud2b8 \uc2a4\uce94\uc744 \uc774\uc694\ud560 \uacbd\uc6b0 target\uac1d\uccb4\ub3c4 \ud568\uaed8 Bean\uc73c\ub85c \ub4f1\ub85d\ud558\uae30 \ub54c\ubb38.."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"\ube48-\ud6c4\ucc98\ub9ac\uae30",children:"\ube48 \ud6c4\ucc98\ub9ac\uae30"}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{alt:"BeanPostProcessor.png",src:t(2355).A+"",width:"1678",height:"606"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\uc2a4\ud504\ub9c1\uc774 \uc800\uc7a5\uc18c\uc5d0 \ube48\uc744 \ub4f1\ub85d\ud558\uae30 \uc804 \uc870\uc791\uc774 \ud544\uc694\ud560 \ub54c \uc0ac\uc6a9\ud558\ub294 \uac83"}),"\n",(0,r.jsxs)(e.li,{children:["\uae30\ub2a5","\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\uac1d\uccb4 \uc870\uc791"}),"\n",(0,r.jsx)(e.li,{children:"\ub2e4\ub978 \uac1d\uccb4\ub85c \ubcc0\ud658"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"\uc608\uc81c-1",children:"\uc608\uc81c 1"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:"// \ube48 \ud6c4\ucc98\ub9ac\uae30 Interface\npublic interface BeanPostProcessor {\n\n    // \ucd08\uae30\ud654 \ubc1c\uc0dd \uc774\uc804 \ucc98\ub9ac \ub85c\uc9c1\n\t@Nullable\n\tdefault Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException {\n\t\treturn bean;\n\t}\n    \n    // \ucd08\uae30\ud654 \ubc1c\uc0dd \uc774\ud6c4 \ucc98\ub9ac \ub85c\uc9c1\n\t@Nullable\n\tdefault Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException {\n\t\treturn bean;\n\t}\n}\n"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:'    @Test\n    void basicConfig() {\n        ApplicationContext applicationContext = new AnnotationConfigApplicationContext(BeanPostProcessorConfig.class);\n\n        B b = applicationContext.getBean("beanA", B.class);\n        b.helloB();\n\n        Assertions.assertThrows(NoSuchBeanDefinitionException.class, () -> applicationContext.getBean(A.class));\n    }\n\n    @Slf4j\n    @Configuration\n    static class BeanPostProcessorConfig {\n        @Bean(name = "beanA")\n        public A a() {\n            return new A();\n        }\n        \n        // \ud6c4\ucc98\ub9ac\uae30 \ub4f1\ub85d\n        @Bean\n        public AToBPostProcessor helloPostProcessor() {\n            return new AToBPostProcessor();\n        }\n    }\n    \n\n    @Slf4j\n    static class A {\n        public void helloA() {\n            log.info("hello A");\n        }\n    }\n\n    @Slf4j\n    static class B {\n        public void helloB() {\n            log.info("hello B");\n        }\n    }\n\n    @Slf4j\n    static class AToBPostProcessor implements BeanPostProcessor {\n\n        @Override\n        public Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException {\n            log.info("beanName={} bean={}", beanName, bean);\n            if (bean instanceof A) {\n                return new B();\n            }\n            return bean;\n        }\n    }\n'})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\uc704 \ucf54\ub4dc\uc5d0\uc11c \ud6c4\ucc98\ub9ac\uae30\ub97c \ud1b5\ud574 A \ud074\ub798\uc2a4\uc77c \uacbd\uc6b0 B\ub97c \ubc18\ud658\ud558\ub3c4\ub85d \ud588\ub2e4"}),"\n",(0,r.jsx)(e.li,{children:"\ud6c4\ucc98\ub9ac\uae30\ub97c Bean\uc73c\ub85c \ub4f1\ub85d\ud558\uba74 A\ub97c \ub4f1\ub85d\ud574\ub3c4 B\uac00 \ub4f1\ub85d\ub418\ub294 \uac83\uc744 \ud655\uc778\ud560 \uc218 \uc788\ub2e4."}),"\n",(0,r.jsx)(e.li,{children:"\ube48 \ud6c4\ucc98\ub9ac\uae30\ub97c \uc0ac\uc6a9\ud558\uba74 Target \uac1d\uccb4\ub97c \ud504\ub85d\uc2dc\ub85c \uad50\uccb4\ud558\ub294 \uac83\ub3c4 \uac00\ub2a5\ud558\ub2e4."}),"\n",(0,r.jsxs)(e.li,{children:["\ucc38\uace0","\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"@PostConstruct\ub3c4 \ube48 \ud6c4\ucc98\ub9ac\uae30\ub97c \ud1b5\ud574 \ud638\ucd9c\ub418\ub294 \uac83"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"\uc608\uc81c-2",children:"\uc608\uc81c 2"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:'// \uc2e4\uc81c \uc801\uc6a9 \ud30c\ud2b8\n@Slf4j\npublic class PackageLogTracePostProcessor implements BeanPostProcessor {\n\n    private final String basePackage;\n    private final Advisor advisor;\n\n    public PackageLogTracePostProcessor(String basePackage, Advisor advisor) {\n        this.basePackage = basePackage;\n        this.advisor = advisor;\n    }\n\n    @Override\n    public Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException {\n        log.info("param beanName={} bean={}", beanName, bean.getClass());\n\n        // \ud328\ud0a4\uc9c0 \uacbd\ub85c \uccb4\ud06c\n        String packageName = bean.getClass().getPackageName();\n        if (!packageName.startsWith(basePackage)) {\n            return bean;\n        }\n        \n        // \ud504\ub85d\uc2dc \uc0dd\uc131\n        ProxyFactory proxyFactory = new ProxyFactory(bean);\n        proxyFactory.addAdvisor(advisor);\n\n        Object proxy = proxyFactory.getProxy();\n        log.info("create proxy: target={} proxy={}", bean.getClass(), proxy.getClass());\n        return proxy;\n    }\n}\n\n@Slf4j\n@Configuration\n@Import({AppV1Config.class, AppV2Config.class})\npublic class BeanPostProcessorConfig {\n\n    @Bean\n    public PackageLogTracePostProcessor logTracePostProcessor(LogTrace logTrace) {\n        return new PackageLogTracePostProcessor("hello.proxy.app", getAdvisor(logTrace));\n    }\n\n    private Advisor getAdvisor(LogTrace logTrace) {\n        //pointcut\n        NameMatchMethodPointcut pointcut = new NameMatchMethodPointcut();\n        pointcut.setMappedNames("request*", "order*", "save*");\n        //advice\n        LogTraceAdvice advice = new LogTraceAdvice(logTrace);\n        return new DefaultPointcutAdvisor(pointcut, advice);\n    }\n}\n'})}),"\n",(0,r.jsx)(e.h2,{id:"\uc2a4\ud504\ub9c1\uc774-\uc81c\uacf5\ud558\ub294-\ube48-\ud6c4\ucc98\ub9ac\uae30",children:"\uc2a4\ud504\ub9c1\uc774 \uc81c\uacf5\ud558\ub294 \ube48 \ud6c4\ucc98\ub9ac\uae30"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\ud604\uc7ac \ud6c4\ucc98\ub9ac\uae30 \ub85c\uc9c1 \ub0b4\ubd80\uc5d0 \ud504\ub85d\uc2dc \uc801\uc6a9 \ub300\uc0c1\uc744 \uac80\uc99d\ud558\ub294 \ub85c\uc9c1\uc774 \ud3ec\ud568\ub418\uc5b4 \uc788\ub2e4."}),"\n",(0,r.jsxs)(e.li,{children:["\uc774 \ubd80\ubd84\uc744 Pointcut\uc73c\ub85c \ub300\uccb4\ud560 \uc218 \uc788\ub2e4.","\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"classfilter\ub85c \ud504\ub85d\uc2dc \uc801\uc6a9 \ub300\uc0c1\uc744 \uac80\uc99d"}),"\n",(0,r.jsx)(e.li,{children:"MethodMatcher\ub85c \uc801\uc6a9 \uba54\uc11c\ub4dc \uac80\uc99d"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"1-autoproxycreator",children:"(1) AutoProxyCreator"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"build.gradle\nimplementation 'org.springframework.boot:spring-boot-starter-aop'\n"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"aop \ub77c\uc774\ube0c\ub7ec\ub9ac\ub974 \ucd94\uac00\ud558\uba74 aspectJ\uad00\ub828 \ub77c\uc774\ube0c\ub7ec\ub9ac\uac00 \uc790\ub3d9 \ub4f1\ub85d\ub418\uace0 AOP\uad00\ub828 \ud074\ub798\uc2a4\ub97c \uc790\ub3d9\uc73c\ub85c Bean\uc73c\ub85c \ub4f1\ub85d\ud574\uc90c"}),"\n"]}),"\n",(0,r.jsx)(e.h4,{id:"annotationawareaspectjautoproxycreator",children:"AnnotationAwareAspectJAutoProxyCreator"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"AnnotationAwareAspectJAutoProxyCreator\uc740 \ube48 \ud6c4\ucc98\ub9ac\uae30\uc774\ub2e4"}),"\n",(0,r.jsx)(e.li,{children:"\uc774 \ud6c4\ucc98\ub9ac\uae30\ub294 \uc2a4\ud504\ub9c1 \ube48\uc73c\ub85c \ub4f1\ub85d\ub41c Advisor\ub97c \ucc3e\uc544 \ud504\ub85d\uc2dc\uac00 \ud544\uc694\ud55c \uacf3\uc5d0 \uc790\ub3d9\uc73c\ub85c \ud504\ub85d\uc2dc\ub97c \uc801\uc6a9\ud574\uc900\ub2e4."}),"\n",(0,r.jsx)(e.li,{children:"\uc989, Advisor\ub9cc Bean\uc73c\ub85c \ub4f1\ub85d\ub418\uc5b4 \uc788\uc73c\uba74 Pointcut \uae30\ubc18\uc73c\ub85c \uc790\ub3d9 \ud504\ub85d\uc2dc \uc801\uc6a9\uc774 \uac00\ub2a5\ud558\ub2e4."}),"\n"]}),"\n",(0,r.jsx)(e.h4,{id:"\ub3d9\uc791-\uacfc\uc815",children:"\ub3d9\uc791 \uacfc\uc815"}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{alt:"AutoProxyCreator.png",src:t(6386).A+"",width:"2140",height:"1082"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"AnnotationAwareAspectJAutoProxyCreator\uac00 Bean\uc73c\ub85c \ub4f1\ub85d\ub41c \ubaa8\ub4e0 Advisor\ub97c \uc870\ud68c"}),"\n",(0,r.jsx)(e.li,{children:"Advisor\uc758 Pointcut\uc744 \ubc14\ud0d5\uc73c\ub85c \ud504\ub85d\uc2dc \uc801\uc6a9 \ub300\uc0c1\uc744 \ud544\ud130\ub9c1 \ud55c\ub2e4."}),"\n",(0,r.jsx)(e.li,{children:"\uc801\uc6a9 \ub300\uc0c1\uc774 \ub41c \uac1d\uccb4\ub97c Target\uc73c\ub85c \ud558\ub294 Proxy\ub97c \uc0dd\uc131\ud558\uace0"}),"\n",(0,r.jsx)(e.li,{children:"Proxy\ub97c \ub300\uc2e0 Bean\uc73c\ub85c \ub4f1\ub85d\ud55c\ub2e4."}),"\n"]}),"\n",(0,r.jsx)(e.h4,{id:"\uc608\uc81c-1-1",children:"\uc608\uc81c 1"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:'@Configuration\n@Import({AppV1Config.class, AppV2Config.class})\npublic class AutoProxyConfig {\n\n//    @Bean\n    public Advisor advisor1(LogTrace logTrace) {\n        //pointcut\n        NameMatchMethodPointcut pointcut = new NameMatchMethodPointcut();\n        pointcut.setMappedNames("request*", "order*", "save*");\n        //advice\n        LogTraceAdvice advice = new LogTraceAdvice(logTrace);\n        return new DefaultPointcutAdvisor(pointcut, advice);\n    }\n\n}\n'})}),"\n",(0,r.jsx)(e.h4,{id:"\ucc38\uace0-pointcut\uc758-\uc0ac\uc6a9-\uc2dc\uc810",children:"[\ucc38\uace0] Pointcut\uc758 \uc0ac\uc6a9 \uc2dc\uc810"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsx)(e.li,{children:"\ud504\ub85d\uc2dc \uc801\uc6a9 \uc5ec\ubd80 \ud310\ub2e8 - \uc0dd\uc131 \uc2dc\uc810"}),"\n",(0,r.jsx)(e.li,{children:"\uc5b4\ub4dc\ubc14\uc774\uc2a4 \uc801\uc6a9 \uc5ec\ubd80 \ud310\ub2e8 - \uc0ac\uc6a9 \uc2dc\uc810"}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"2-aspectjexpressionpointcut",children:"(2) AspectJExpressionPointcut"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:'    @Bean\n    public Advisor advisor2(LogTrace logTrace) {\n        //pointcut\n        AspectJExpressionPointcut pointcut = new AspectJExpressionPointcut();\n        \n        // AspectJ \ud45c\ud604\uc2dd\n        pointcut.setExpression("execution(* hello.proxy.app..*(..))");\n        //advice\n        LogTraceAdvice advice = new LogTraceAdvice(logTrace);\n        return new DefaultPointcutAdvisor(pointcut, advice);\n    }\n'})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"AOP\uc5d0 \ud2b9\ud654\ub41c Pointcut \ud45c\ud604\uc2dd"}),"\n",(0,r.jsx)(e.li,{children:"\uc790\uc138\ud55c \uc124\uba85\uc740 \ucd94\ud6c4\uc5d0..."}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"\ucc38\uace0-pointcut-\uc5ec\ub7ec\uac1c\ub97c-\ub9cc\uc871\ud558\ub294-bean\uc740",children:"\ucc38\uace0: Pointcut \uc5ec\ub7ec\uac1c\ub97c \ub9cc\uc871\ud558\ub294 Bean\uc740?"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\uc0dd\uac01\ud574\ubcf4\uba74 ProxyFactory\ub294 \uc5ec\ub7ec Advisor\ub97c \uac00\uc9c8 \uc218 \uc788\ub2e4."}),"\n",(0,r.jsx)(e.li,{children:"\ub54c\ubb38\uc5d0 Proxy\ub3c4 1\uac1c\ub9cc \uc0dd\uc131\ub428"}),"\n"]})]})}function p(n={}){const{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(d,{...n})}):d(n)}},6386:(n,e,t)=>{t.d(e,{A:()=>r});const r=t.p+"assets/images/AutoProxyCreator-a7c1f97a5b7c68248943715599b12112.png"},2355:(n,e,t)=>{t.d(e,{A:()=>r});const r=t.p+"assets/images/BeanPostProcessor-f751a6e7af41664188dc38116ef2f418.png"},8453:(n,e,t)=>{t.d(e,{R:()=>a,x:()=>s});var r=t(6540);const i={},o=r.createContext(i);function a(n){const e=r.useContext(o);return r.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function s(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:a(n.components),r.createElement(o.Provider,{value:e},n.children)}}}]);